<!-- home.html -->

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Coffee Brew Helper</title>
    <!-- Add any CSS links, meta tags, or other head elements here -->
    <style>
        .highlighted-step {
            /* Add your CSS styling for highlighting here */
            background-color: yellow; /* Example: Highlight the step with a yellow background */
        }
    </style>
</head>
<body>
    <h1>Coffee Brew Helper</h1>
    
    <!-- Input element to display elapsed time -->
    <input type="text" id="elapsed-time" readonly value="0">

    <table border="1" id="brewing-steps">
        <thead>
            <tr>
                <th>Step</th>
                <th>Change in Water</th>
                <th>Target Water</th>
                <th>Change in Time</th>
                <th>Target Time</th>
                <th>Executed Time</th>
            </tr>
        </thead>
        <tbody>
            {% for step in steps %}
            <tr>
                <td>{{ step.step_id }}</td>
                <td>{{ step.change_in_water }}</td>
                <td>{{ step.target_total_water }}</td>
                <td>{{ step.change_in_time }}</td>
                <td>{{ step.target_total_time }}</td>
                <td id="executed-time-{{ step.step_id }}"></td>
            </tr>
            {% endfor %}
        </tbody>
    </table>

    <!-- Buttons for controlling the timer -->
    <button id="startPauseButton" onclick="toggleTimer()">Start</button>
    <button onclick="resetTimer()">Reset</button>
    <button onclick="onNextClicked()">Next</button>

    <!-- Add any JavaScript scripts or other body elements here -->
    <script>
        // Get all rows of the table
        const rows = document.querySelectorAll('#brewing-steps tbody tr');
        
        let stepIndex = 0;
        let executedStepIndex = 0;
        let elapsedTime = 0;
        let timer;

        let isTimerRunning = false;

        // Function to remove higlight from all steps
        function removeHighlightStep(){
            rows.forEach(row => {
                row.classList.remove('highlighted-step'); // Remove highlight from all rows
            });
        }
        // Function to highlight the current step
        function highlightStep() {
            removeHighlightStep();
            rows[stepIndex].classList.add('highlighted-step'); // Highlight the current step
        }

        // Function to update elapsed time in the input element
        function updateElapsedTime() {
            const elapsedTimeInput = document.getElementById('elapsed-time');
            elapsedTimeInput.value = elapsedTime; // Update input value with elapsed time
        }
        
        function toggleTimer() {
            const startPauseButton = document.getElementById('startPauseButton');

            if (!isTimerRunning) {
                startTimer();
                startPauseButton.textContent = 'Pause'; // Change button text to 'Pause'
            } else {
                pauseTimer();
                startPauseButton.textContent = 'Start'; // Change button text to 'Start'
            }

            isTimerRunning = !isTimerRunning; // Toggle timer status
        }

        // Function to start the timer and highlight steps based on target_total_time
        function startTimer() {
            highlightStep();
            timer = setInterval(() => {
                // Highlight the current step
                if (stepIndex >= rows.length) {
                    clearInterval(timer); // Stop the timer when all steps are completed
                } else {
                    const currentStepTotalTime = parseInt(rows[stepIndex].querySelector('td:nth-child(5)').textContent);
                    if (elapsedTime >= currentStepTotalTime) {
                        stepIndex++;
                        highlightStep();
                    }
                    elapsedTime += 1; // Increment elapsed time (assuming 1 second intervals)
                    updateElapsedTime(); // Update elapsed time in the input element
                }
            }, 1000); // Timer interval: 1 second (adjust as needed)
        }
        // Function to stop the timer
        function pauseTimer() {
            clearInterval(timer);
        }

        // Function to reset the timer and step index
        function resetTimer() {
            clearInterval(timer);
            stepIndex = 0;
            executedStepIndex = 0;
            elapsedTime = 0;
            removeHighlightStep();
            updateElapsedTime(); // Update elapsed time in the input element

            // Clear the executed-time column
            const timeTakenCells = document.querySelectorAll('[id^="executed-time-"]');
            timeTakenCells.forEach(cell => {
                cell.textContent = ''; // Clear the content of executed-time cells
            });
        }

        // Function to record time taken and update step
        function onNextClicked() {
            // Record current time for the current step
            const currentStepId = executedStepIndex + 1; // Assuming stepIndex starts from 0
            const timeTakenCell = document.getElementById(`executed-time-${currentStepId}`);
            timeTakenCell.textContent = elapsedTime;

            // Update step for the user
            executedStepIndex++; // Increment step index for the user
        }
    </script>
</body>
</html>
